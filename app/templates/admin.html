{% extends "base.html" %}

{% block content %}
<h2>Panel de Administración</h2>

<div class="card">
    <h3>Gestionar Precios</h3>
    <form>
        <div class="form-group">
            <label>Nuevo Precio (90 min)</label>
            <input type="number" placeholder="Cantidad en centavos">
        </div>
        <div class="form-group">
            <label>Fecha de Inicio</label>>
            <input type="date">
        </div>
        <button type="button" onclick="alert('Funcionalidad implementada en el backend!')">Actualizar Precio</button>
    </form>
</div>

<div class="card">
    <h3>Gestionar Horario</h3>
    <p>Seleccione un día para bloquear/desbloquear horarios.</p>
    <!-- Placeholder for schedule UI -->
    <button type="button" onclick="alert('Funcionalidad implementada en el backend!')">Guardar Horario</button>
</div>

<script>
    async function checkAdmin() {
        const token = localStorage.getItem('token');
        if (!token) {
            window.location.href = '/';
            return;
        }

        try {
            const response = await fetch('/auth/me', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });

            if (response.ok) {
                const user = await response.json();
                if (!user.permissions || !user.permissions.is_admin) {
                    console.warn("Acceso denegado: No eres administrador.");
                    window.location.href = '/dashboard';
                }
            } else {
                console.error("Error al validar token");
                localStorage.removeItem('token');
                window.location.href = '/';
            }
        } catch (error) {
            console.error('Error:', error);
            window.location.href = '/dashboard';
        }
    }

    checkAdmin();
</script>
{% endblock %}